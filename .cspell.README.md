# cspell Configuration - KhipuVault

This document describes the cspell (spell checker) configuration for KhipuVault.

## What is cspell?

cspell is a spell checker for code that helps catch typos in:

- Comments and documentation
- Variable names and function names
- Markdown documentation
- Code strings

## Quick Start

```bash
# Check all files
pnpm spell:check

# Check only staged files (for pre-commit)
pnpm spell:check:changed
```

## How It Works

cspell automatically runs on markdown files during `git commit` via lint-staged. It does NOT block commits for TypeScript/JavaScript files to avoid false positives from variable names, package imports, etc.

### What Gets Checked

- TypeScript/JavaScript files (.ts, .tsx, .js, .jsx) - comments and strings only
- Solidity files (.sol) - comments and strings only
- Markdown documentation (.md) - full content
- JSON configuration files (.json) - string values only

### What Gets Ignored

- node_modules and build outputs
- Generated files (Prisma client, contract artifacts)
- String literals in import statements
- Hex addresses (0x...)
- Package names (@khipu/web3)
- Version numbers (v1.2.3)
- Common abbreviations (tx, msg, src, dest)

## Configuration Files

### .cspell.json

Main configuration file with:

- File patterns to check
- Paths to ignore
- Regex patterns for ignoring specific content
- Dictionary references
- Language settings

### .cspell-custom.txt

Project-specific dictionary with terms organized by category:

- Project Names (KhipuVault, Khipu)
- Blockchain & DeFi Terms (Mezo, MUSD, DeFi, TVL)
- Solidity Terms (uint256, nonReentrant, delegatecall)
- Tech Stack (wagmi, viem, prisma, tanstack)
- Libraries & Packages
- Abbreviations & Acronyms (JWT, SIWE, API, RPC)
- Contract Names (IndividualPool, CooperativePool)
- Common Variable Names

### lint-staged.config.js

Git hook configuration that runs cspell on markdown files during commit.

## Adding Words to Dictionary

### When to Add a Word

Add a word to `.cspell-custom.txt` if it is:

- A project-specific term (KhipuVault, Mezo)
- A blockchain/DeFi term (DeFi, stablecoin, gwei)
- A library or tool name (wagmi, viem, prisma)
- A technical abbreviation (JWT, API, RPC)
- A contract name (IndividualPool, YieldAggregator)

### How to Add a Word

1. Open `.cspell-custom.txt`
2. Find the appropriate section (or create a new one)
3. Add the word on a new line
4. Save the file

Example:

```bash
nano .cspell-custom.txt

# Add under "Blockchain & DeFi Terms"
satoshis
tBTC
mBTC
```

## When NOT to Add a Word

Do NOT add to dictionary if it's:

- A misspelled word (fix the typo instead)
- A one-off variable name (use inline ignore)
- A temporary comment (fix the spelling)

## Inline Ignore

For special cases, use inline comments:

### Ignore Next Line

```typescript
// cspell:disable-next-line
const myWeirdVariableName = "xyz123abc";
```

### Ignore Block

```typescript
/* cspell:disable */
// Multiple lines with special terms
const var1 = "specialterm";
const var2 = "anotherterm";
/* cspell:enable */
```

### Ignore Entire File

```typescript
/* cspell:disable */

// Rest of file is ignored
```

## Integration with Pre-commit

cspell runs automatically on markdown files when you run `git commit`. This ensures documentation quality without being too noisy about code.

### What Runs

- `prettier --write` - Format markdown
- `cspell --no-must-find-files` - Spell check

### Bypass Hook

If you need to commit urgently:

```bash
git commit --no-verify -m "fix: critical bug"

# Then fix spelling later
pnpm spell:check
```

## Common Issues

### False Positives in Code

cspell is configured to ignore most code patterns:

- Hex addresses: `0xdfBEd2D3efBD2071fD407bF169b5e5533eA90393`
- Solidity types: `uint256`, `bytes32`
- Package names: `@khipu/web3`, `wagmi`
- Short names: `tx`, `msg`, `ctx` (< 3 chars ignored)

If you still get false positives, add to `.cspell-custom.txt`.

### Word Not Being Ignored

Check:

1. Is the word in `.cspell-custom.txt`? (case-insensitive)
2. Is it spelled correctly in the dictionary?
3. Is it at least 3 characters long? (minWordLength: 3)
4. Try running `pnpm spell:check` again after adding

### Pre-commit Hook Failing

If cspell blocks your commit on a markdown file:

1. Fix the actual typos
2. Add project terms to `.cspell-custom.txt`
3. For special cases, use inline `cspell:disable-next-line`
4. Emergency bypass: `git commit --no-verify`

## CI Integration

cspell is NOT enabled in CI by default. To add it:

```yaml
# .github/workflows/ci.yml
- name: Spell Check
  run: pnpm spell:check
```

This is optional since false positives can be noisy in CI.

## Statistics

Current project status:

- 390 files checked
- ~680 issues found initially (mostly Spanish comments and library names)
- Core project terms added to custom dictionary
- Pre-commit integration enabled for markdown only

## Tips

### Check Specific Files

```bash
# Single file
pnpm exec cspell apps/web/README.md

# Glob pattern
pnpm exec cspell "apps/web/**/*.tsx"

# Multiple patterns
pnpm exec cspell "*.md" "packages/**/*.ts"
```

### Temporarily Disable

```bash
# Skip pre-commit
git commit --no-verify

# Disable cspell in a file
/* cspell:disable */
```

### Add Multiple Words at Once

```bash
# Append to custom dictionary
cat >> .cspell-custom.txt << EOF
myword1
myword2
myword3
EOF
```

## Resources

- [cspell Documentation](https://cspell.org/)
- [cspell Configuration](https://cspell.org/configuration/)
- [KhipuVault Spelling Guide](./SPELLING_GUIDE.md) - Comprehensive guide
- [Quick Reference](./.cspell.quickref.md) - Commands and shortcuts

## Support

If you have questions:

1. Check `SPELLING_GUIDE.md` for detailed explanations
2. Review `.cspell-custom.txt` for existing terms
3. Ask in team chat if unsure about adding a word

Remember: The goal is to catch real typos, not to be perfect. When in doubt, add to the dictionary and move on!
